# 计算机网络和因特网

硬件：端系统、通信链路、分组交换机

通信链路和分组交换机软件：

​		报文：包含 控制功能 和 数据 的信息包。

​		分组：（数据分段+首部字节）形成的信息包

​		路径：分组从一个端系统到另一个端系统经历的（通信链路+分组交换机）

因特网服务提供商（ISP）：提供通信链路和分组交换机，使得小网络汇聚成大网络（端系统 -（边缘路由器）- 低层ISP --高层ISP -- 互联-（高速路由器）-）

端系统软件：

​		协议：定义了在两个或多个实体之间交换报文的格式和顺序，以及报文发送、接收或其他事件的动作。

​		套接字接口：规定 其他端系统 向 本端系统 交付数据的方式



### 端系统（主机）

计算机、平板、手机



### 通信链路

电缆、铜线、光纤、无线电

传输速率：bit/s



### 分组交换机

分组交换机：路由器、链路层交换机

路由器：

​		边缘路由器：DSL、电缆、FTTH（光纤）、拨号、卫星、以太网、WIFI、3G

​		高速路由器：高层ISP互联使用的路由器



### 分组的交换

计算机网络中信心的交换方式包括三种：

​		分组交换：将大的报文（数据）分成小的数据包，再进行报文交换。

​		电路交换：两端用专用电路进行交换。

​		报文交换：多个站点，路由寻址。



##### 分组交换的特点

​		存储转发传输：接受完整的分组后，再发送。

​		排队时延：分组在输出缓存中等待其他分组传输的时间。

​		分组丢失：输出缓存满了后，会出现丢包现象。

​		转发表：分组首部包含IP地址，转发表会将IP地址映射成输出链路。

​		路由选择协议：用于自动的生成转发表。



##### 分组交换的时延

​		节点处理时延：检查分组首部、决定导向何处 等处理 所需时间。

​		排队时延：分组在输出缓存中等待其他分组传输的时间。

​		传输时延：分组从路由器到链路的时间。分组长度L / 链路传输速率R。

​		传播时延：两个路由器之间传播时间。距离d / 链路传输速率R。



### 协议

协议：定义了在两个或多个实体之间交换报文的格式和顺序，以及报文发送、接收或其他事件的动作。

​			协议通过软件、硬件或两者结合来实现。某层协议的不同部分往往位于不同组件当中。

协议分层：只要某层对上面的层提供相同的服务，并且使用来自下面层次的相同服务，该层实现变化时，其余层不变。即可通过分层的体系结构，实现复杂系统。

​					协议栈由物理层、链路层、网络层、运输层和应用层 构成。



**应用层**

应用层协议分布于多个端系统中。

应用层协议包括：HTTP、FTP、DNS。

报文：应用层的信息分组。



**运输层**

运输层协议包括：TCP、UDP。

报文段：运输层的信息分组。报文段是报文加上运输层信息



**网络层**

网络层协议包括：IP、路由选择协议。

数据报：网络层的信息分组。数据报是报文段加上网络层信息



**链路层**

链路层协议包括：以太网，WIFI。

帧：链路层的信息分组。帧是数据报加上链路层信息



**物理层**

物理层协议包括：双绞铜线、同轴电缆。

物理层传输的是比特。



### 数据路径

源：应用层 --> 运输层  --> 网络层 --> 链路层 --> 物理层 --> 

链路层交换机： --> 物理层 -->链路层 --> 物理层 -->  

路由器： -->  物理层 -->  链路层 -->  网络层 -->  链路层 -->  物理层 -->  

目的地： -->  物理层 -->  链路层 -->  网络层 -->  运输层 -->  应用层



# 应用层

应用层主要用于是编写 运行在不同端系统  通过网络彼此通信的网络应用。

应用层通过 进程控制 套接字接口控制 运输层 进行通信。



### 网络应用体系结构

客户-服务器体系结构特点：

​		客户之间不直接通信，服务器具有固定的，周知的，总是打开的地址。

​		应用程序：WEB、FTP、Telnet、电子邮件。

P2P体系结构特点：

​		在间断连接的主机对之间直接通信。

​		应用程序：文件共享、P2P下载。



### 进程通信

进程是什么？套接字接口是什么？



程序通过进程互相通信。可以是同一台主机上的进程互相通信，也可以是不同端系统间的进程通过网络进行通信。

发送进程（客户进程） 生成并发送报文。接收进程（服务器进程） 接收并响应报文。



进程通过**套接字接口**连接网络，进行通信。

套接字接口是应用层和运输层之间的接口。



进程间寻址：通过IP地址和端口号，唯一标识主机和进程的套接字接口。



### 应用层控制运输层

应用层由开发者控制，运输层由操作系统控制。

开发者对运输层的控制包括：选择运输层协议。设置少量运输层参数。



应用层选择运输层协议的考虑：TCP 或者 UDP 。

是否容忍数据丢失、是否安全。

是否带宽敏感、是否时间敏感。这两种保证与协议无关。



### 应用层协议

网络应用包括：客户程序、服务器、其他标准、应用层协议等。



## Web和HTTP

web程序的应用层协议是HTTP协议。

web应用包括浏览器和服务器，他们分别实现了HTTP的客户程序和服务程序。

HTTP 由客户程序和服务器程序构成，该协议定义了报文的结构和交换报文的方式



web页面由对象组成。

一个对象是一个文件，多数页面由 HTML基本文件 和几个 引用对象 构成。每个文件通过URL地址寻址。

URL地址：存放对象的 主机名（网址或IP） 和对象的 路径名。



HTTP规定了客户和服务器之间的请求响应方式。HTTP选择TCP作为运输层协议。HTTP是一个无状态协议。

web根据URL地址建立TCP连接，通过套接字接口，发送HTTP请求报文，服务器返回HTTP响应报文。



### HTTP报文格式

##### 请求报文

HTTP请求报文至少为一行。包括请求行，首部行，也可能有实体体。例：



GET	/some/page.html	HTTP/1.1

Host：www.someschool.edu

Connection：close

User-agent：Mozilla/5.0

Accept-language：fr



第一行叫做**请求行**，包括：方法字段、URL字段、HTTP版本字段。

方法字段包括：GET、POST、HEAD、PUT、DELETE

POST请求要在首部行之后多一个**实体体**，用于发送表单内容。查

GET请求可以用扩展URL的方式发送表单内容，但不安全。查

HEAD请求同GET请求，但是不返回对象。查

PUT请求用于上传对象。增

DELETE请求用于删除对象。删



其余行叫做**首部行**。例：

Host：www.someschool.edu			主机地址

Connection：close							  返回即关闭TCP连接

User-agent：Mozilla/5.0					指出浏览器版本

Accept-language：fr						   要求语言为法语



##### 响应报文

响应报文包括初始状态行、6个首部行、实体体。例：



HTTP/1.1	200	OK

Connection：close

Data：Tue，18	Aug	2015	15:44:04	GMT

Server：Apache/2.2.3（CentOS）

Last-Modified：Tue，18	Aug	2015	15:41:04	GMT

Content-Length：6821

Content-Type：text/html

（data	data	data	data	data	data	data）



初始状态行：协议版本字段、状态码、状态信息

​		200：请求成功

​		301：对象被转移，重定向

​		400：服务器不理解

​		404：文档不在服务器

​		505：服务器不支持HTTP版本



首部行：

Connection：close																				   发送报文后，关闭TCP连接

Data：Tue，18	Aug	2015	15:44:04	GMT								  发送响应报文的时间

Server：Apache/2.2.3（CentOS）														 web服务器版本

Last-Modified：Tue，18	Aug	2015	15:41:04	GMT				  请求的对象最后一次修改时间

Content-Length：6821																			对象字节数

Content-Type：text/html			·															对象类型



### cookie

cookie组件：

1. HTTP响应报文的cookie首部行

		2.	HTTP请求报文的cookie首部行
  		3.	用户浏览器管理的cookie文件
  		4.	服务器上的web数据库



cookie过程：

首次请求aa.com。

服务器生成表项，并返回cookie。

浏览器管理该cookie，并在下次访问aa.com使用。

服务器通过该cookie，管理该客户的信息。



### 代理服务器

web缓存也叫代理服务器。既是客户，也是服务器。

代理服务器用于缓存静态资源。



机构使用好处：

1. 减少一个机构接入到网络的通信量
2. 减少客户请求的响应时间，客户与代理服务器常常高速连接。



条件GET方法

代理服务器每次会发一个包含‘If-Modified-Since’首部行的get请求。

响应报文会返回最新的对象或者不返回对象。

用于保持代理服务器中最新的对象副本。



## DNS：域名系统

识别主机两种方式：主机名（网址）、IP地址



DNS：主机名转换成IP地址。通常被其他应用层协议调用。

1. 由分层DNS服务器实现的分布式数据库。
2. 使主机可以查询分布式数据库的应用层协议。运输层使用UDP连接。



高级用法：

1. 主机别名：一个IP对应多个主机
2. 负载分配：一个主机对应多个IP，循环使用访问。



# 运输层



































































# 虚拟机网络模型

虚拟机网络模型有4种

隔离模式：桥和虚拟机（虚拟网卡）即可实现。两个虚拟机通过桥通信。

路由模式：两个虚拟桥配上不同网段的ip，即可通过虚拟路由通信。不同物理机上的虚拟机需要路由映射之后才能通信。

NAT模式：在路由模式的基础上，将虚拟路由转发到物理网卡上。

桥接模式：将物理网卡映射到桥上。可访问互联网。要求虚拟机网段与物理机相同。





















































