https://zhuanlan.zhihu.com/p/111904993



# 搜索引擎

整个搜索引擎 完成的任务都是根据 query 找到 item 。还可以完成搜索热词，搜索历史等功能。

线上执行检索时大体可以分为基础检索（BS）和高级检索（AS）两个过程，BS是ES召回，AS是融合query理解，排序等模块得到最终结果。

![preview](https://raw.githubusercontent.com/zhanghongyang42/images/main/v2-4161904bd2deaf1ba915cdbea7d95edb_r.jpg)

![preview](https://raw.githubusercontent.com/zhanghongyang42/images/main/v2-b39d1057d427a7b615f02a9e1ed999f5_r.jpg)



# Query 理解

整个query理解完成的工作基本属于NLP范畴。



![img](https://raw.githubusercontent.com/zhanghongyang42/images/main/3518230-792daf9df3ff62b4.png)



### Query预处理

 全半角、大小写、简繁体转换、无意义符号移除、Query截断。



### Query分词

分词可以进行粗细粒度两种分词，优先使用粗粒度分词结果进行召回，数量不够时使用细粒度分词进行召回。可以采用开源的实现（jieba）+ 领域内的字典。

新词发现：对于网络热词和垂直领域的专业词汇分词效果不好时，可以使用新词发现，及时发现新词。具体方法可以基于统计，矩阵，转化为二分类，序列标注等



### Term紧密度分析

衡量query中任意两个term之间的紧密程度，如 query “下载深海大作战”，经分词工具可能切分成“下载 深海 大 作战”，但其实“大”和“作战”的紧密度很高。



召回构造查询索引的逻辑表达式中可以要求紧密度高的两个term需共同出现。

在proximity计算公式中融合考虑进去，从而保证query中紧密度高的两个term在item中出现距离更近更相关。



### Term重要性分析

做query理解 和 item内容理解 时均需要进行term重要性分析。

我们可以将term重要性分为4个级别，重要性由高到低分别是：核心词、限定词、可省略词、干扰词。

可以对重要的term进行优先召回。



item内容侧的term重要性可以采用LDA主题模型、TextRank等方法来挖掘。

query侧的term重要性，比较容易想到的方法就是把它视为分类或回归问题来考虑，通过训练svm、gbdt等传统机器学习模型即可进行预测。



### Query纠错

![preview](https://raw.githubusercontent.com/zhanghongyang42/images/main/v2-c338433788537722c613456a5ed45b49_r.jpg)

query纠错 对每一种错误类型都采用不同的方法策略进行纠错，然后将纠错结果进行融合。需要人工干预纠错规则生成词包或者模型。



### Query扩展

就是自动补全query词，如‘自然语言处理’ 补全为 ‘自然语言处理入门’。

可以通过搜索session序列共现，Graph Embedding等多种方法来实现。



### Query归一

简单的就是进行同义词近义词扩展，目的是为了实现将语义相近的冷门词变成item侧的标准词。如 将“腾讯台球”归一到“腾讯桌球” 。

一般使用业界开源的库，也可以用NLP的方法自己做同义词库。



### 意图识别

用户的搜索query表达不够明确带来的意图歧义性或用户本身搜索意图存在多样性，比如：query“择天记”可能是想下载玄幻类游戏，也可能是想看择天记电视剧。

还有用户的性别、年龄不同，搜索同一query的意图可能不一样，当前时刻搜索query的意图可能和上一时刻搜索query相关等。



简单的可以进行意图分类，建立标签体系，对用户要搜索的类别进行意图预测。



# 检索召回

包括：传统的基于词的文本匹配召回、基于向量的语义匹配召回。



文本匹配召回主要通过 ES（倒排索引+bool检索）来实现。

语义匹配召回通过相似度计算（BM25），Bert等方法计算语义相近的词语，如‘苹果’和‘iphone’。



# 排序

排序的3个发展阶段：

1、一个就是业务专家使用排序公式，给各个因子以合适的系数，达到不错的排序效果，一般因子多是商品商家维度，最后达到一个千人一面的展示。

2、机器学习learning to ranking：使用GBDT+LR，除了商品商家特征外，更多的加入用户和商品交互的特征或者行为特征，达到一个千人千面的效果。

3、深度模型：embedding + 深度学习网络，利用深度学习的能力，提升排序的效果，不过需要更多的数据和更高的机器配置，否则效果不一定好。














